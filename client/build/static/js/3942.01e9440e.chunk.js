"use strict";(self.webpackChunkdatta_able_rv18_0_4=self.webpackChunkdatta_able_rv18_0_4||[]).push([[3942],{63942:function(e,t,s){s.r(t),s.d(t,{default:function(){return me}});var a=s(35531),r=s(18489),n=s(27853),i=s(84531),d=s(78932),o=s(38128),l=s(47313),c=s(44030),h=s(63849),u=s(65832),p=s(93298),m=s(31616),f=s(47939),x=s(37062),_=s(54991),g=s(62396),j=s(54972),Z=s(89351),y=s(33032),F=s(23430),v=s(78994),S=s.n(v),b=s(88195),C=s.n(b),k=s(82737),N=s.n(k),w=s(67989),A=s.n(w),L=s(1693),D=s.n(L),E=s(87606),T=s.n(E),H=s(60823),M=s.n(H),K=(s(44789),s(37417)),q=s.n(K),I=(s(99086),s(68234)),R=s.n(I),B=s(87366),O=s.n(B),U=s(70021),V=s.n(U),z=s(44236),W=s.n(z),G=s(19893),J=s.n(G),Y=(s(6855),s(28668)),P=s.n(Y),Q=s(51426),X=s(46417),$=function(e){var t,s=(0,l.useRef)(),a=(0,l.useState)(),r=(0,F.Z)(a,2);r[0],r[1];(0,l.useEffect)((function(){return s.current||n(),function(){s.current.destroy(),s.current=null}}),[e.editorState]);var n=function(){t=new(C())({holder:"".concat(e.holder),logLevel:"ERROR",data:e.editorState,onReady:function(){s.current=t},onChange:function(){var t=(0,y.Z)(S().mark((function t(s,a){return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.saver.save().then((function(t){e.handleEditorChange(t)}));case 1:case"end":return t.stop()}}),t)})));return function(e,s){return t.apply(this,arguments)}}(),readOnly:e.readOnly,autofocus:!0,minHeight:100,tools:{header:{class:N(),config:{placeholder:"Enter a header",levels:[2,3,4,5,6],defaultLevel:3},inlineToolbar:!0},list:{class:A(),inlineToolbar:!0},Marker:{class:J(),config:{colorCollections:["#000000","#FF0000","#00FF00","#0000FF","#999999","#00FFFF","#FF00FF","#800080","#FFF"],defaultColor:"#FFF",type:"marker"}},underline:W(),code:O(),quote:V(),table:{class:M(),inlineToolbar:!0,config:{rows:2,cols:3}},Color:{class:J(),config:{colorCollections:["#000000","#FF0000","#00FF00","#0000FF","#999999","#00FFFF","#FF00FF","#800080","#FFF"],type:"text"}},textAlign:P(),image:{class:T(),config:{uploader:{uploadByFile:function(t){return(0,y.Z)(S().mark((function s(){var a,r;return S().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if((a=new FormData).append("file",t),!e.thread){s.next=8;break}return s.next=5,(0,Q.cE)(e.thread._id.toString(),e.thread.student_id._id.toString(),a);case 5:r=s.sent,s.next=11;break;case 8:return s.next=10,(0,Q.Ix)(a);case 10:r=s.sent;case 11:return s.abrupt("return",{success:1,file:{url:r.data.data}});case 12:case"end":return s.stop()}}),s)})))()},uploadByUrl:function(e){return(0,y.Z)(S().mark((function t(){return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{success:1,file:{url:e}});case 1:case"end":return t.stop()}}),t)})))()}}}},elimiter:R(),embed:{class:D(),inlineToolbar:!1,config:{services:{youtube:!0,coub:!0}}},inlineCode:{class:q()}}})};return(0,X.jsx)(l.Fragment,{children:(0,X.jsx)("div",{id:"".concat(e.holder)})})},ee=s(44416),te=s(7077),se=s.n(te),ae=s(51767),re=s(17947),ne=function(e){(0,d.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,n.Z)(this,s);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={editorState:null,ConvertedContent:"",isLoaded:!1},e}return(0,i.Z)(s,[{key:"componentDidMount",value:function(){var e=this,t=null;if(this.props.message.message&&"{}"!==this.props.message.message)try{t=JSON.parse(this.props.message.message)}catch(s){t={time:new Date,blocks:[]}}else t={time:new Date,blocks:[]};this.setState((function(s){return(0,r.Z)((0,r.Z)({},s),{},{editorState:t,ConvertedContent:t,isLoaded:e.props.isLoaded})}))}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return(0,X.jsx)("div",{style:{position:"fixed",top:"40%",left:"50%",transform:"translate(-50%, -50%)"},children:(0,X.jsx)(c.Z,{animation:"border",role:"status",children:(0,X.jsx)("span",{className:"visually-hidden"})})});var t=this.props.message.file.map((function(t,s){return(0,X.jsxs)(h.Z,{children:[(0,X.jsx)(m.Z,{md:1,style:{cursor:"pointer"},children:(0,X.jsx)("h5",{children:(0,X.jsx)("span",{children:(0,X.jsx)("a",{href:"".concat(Z._,"/api/document-threads/").concat(e.props.documentsthreadId,"/").concat(e.props.message._id.toString(),"/").concat(t.path.replace(/\\/g,"/").split("/")[2]),target:"_blank",children:(0,X.jsx)(ee.a,(0,r.Z)({size:"sm",radius:4,extension:t.name.split(".").pop()},ee.j[t.name.split(".").pop()]))})})})}),(0,X.jsx)(m.Z,{md:11,className:"my-3",children:(0,X.jsx)("a",{href:"".concat(Z._,"/api/document-threads/").concat(e.props.documentsthreadId,"/").concat(e.props.message._id.toString(),"/").concat(t.path.replace(/\\/g,"/").split("/")[2]),target:"_blank",children:t.name})})]},s)}));return(0,X.jsxs)(u.Z,{border:"primary",className:"mb-2 mx-0",children:[(0,X.jsx)(u.Z.Header,{onClick:function(){return e.props.singleExpandtHandler(e.props.idx)},as:"h5","aria-controls":"accordion"+this.props.idx,"aria-expanded":this.props.accordionKeys[this.props.idx]===this.props.idx,children:(0,X.jsxs)(h.Z,{className:"my-0",children:[(0,X.jsx)(m.Z,{md:1,className:"me-1 my-0",children:(0,X.jsx)(re.Z,(0,r.Z)({},(0,ae.GZ)(this.props.message.user_id.firstname+" "+this.props.message.user_id.lastname)))}),(0,X.jsxs)(m.Z,{className:"mt-2",children:[(0,X.jsxs)("b",{children:[this.props.message.user_id.firstname," ",this.props.message.user_id.lastname]}),(0,X.jsxs)("span",{style:{float:"right",cursor:"pointer"},children:[new Date(this.props.message.createdAt).toLocaleTimeString(),", ",new Date(this.props.message.createdAt).toLocaleDateString(),(0,X.jsx)(j.job,{className:"ms-4"})]})]})]})}),(0,X.jsx)(g.Z,{in:this.props.accordionKeys[this.props.idx]===this.props.idx,children:(0,X.jsxs)(u.Z.Body,{children:[(0,X.jsx)("section",{children:(0,X.jsx)(se(),{data:this.state.editorState})}),t]})})]})}}]),s}(l.Component),ie=ne,de=function(e){(0,d.Z)(s,e);var t=(0,o.Z)(s);function s(){return(0,n.Z)(this,s),t.apply(this,arguments)}return(0,i.Z)(s,[{key:"render",value:function(){var e=this,t=this.props.thread.messages.map((function(t,s){return(0,X.jsx)(ie,{documentsthreadId:e.props.documentsthreadId,accordionKeys:e.props.accordionKeys,singleExpandtHandler:e.props.singleExpandtHandler,id:t._id,idx:s,message:t,onTrashClick:e.props.onTrashClick,lastupdate:e.props.lastupdate,isLoaded:e.props.isLoaded},s)}));return(0,X.jsx)(X.Fragment,{children:t})}}]),s}(l.Component),oe=de,le=s(67203);var ce=function(e){var t=(0,l.useState)({editorState:e.editorState}),s=(0,F.Z)(t,2),a=s[0],n=s[1];return(0,l.useEffect)((function(){n((function(t){return(0,r.Z)((0,r.Z)({},t),{},{editorState:e.editorState})}))}),[e.editorState]),(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(h.Z,{style:{textDecoration:"none"},children:(0,X.jsx)(m.Z,{className:"my-0 mx-0",children:(0,X.jsx)($,{holder:"editorjs",thread:e.thread,readOnly:!1,handleEditorChange:function(e){n((function(t){return(0,r.Z)((0,r.Z)({},t),{},{editorState:e})}))},handleClickSave:e.handleClickSave,editorState:e.editorState,setStatedata:n})})}),(0,X.jsxs)(h.Z,{children:[(0,X.jsx)(m.Z,{md:8,children:(0,X.jsx)(le.Z.Group,{controlId:"formFile",className:"mb-2",children:(0,X.jsx)(le.Z.Control,{type:"file",onChange:function(t){return e.onFileChange(t)}})})}),(0,X.jsx)(m.Z,{className:"mt-2",md:4,children:"(max. 2MB)"})]}),(0,X.jsx)(h.Z,{children:(0,X.jsx)(m.Z,{className:"my-0 mx-0",children:(0,X.jsx)(p.Z,{disabled:!a.editorState.blocks||0===a.editorState.blocks.length||e.buttonDisabled,onClick:function(t){return e.handleClickSave(t,a.editorState)},children:"Save"})})})]})},he=s(82423),ue=s(20688),pe=function(e){(0,d.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,n.Z)(this,s);for(var i=arguments.length,d=new Array(i),o=0;o<i;o++)d[o]=arguments[o];return(e=t.call.apply(t,[this].concat(d))).state={error:null,timeouterror:null,unauthorizederror:null,pagenotfounderror:null,file:null,isLoaded:!1,isSubmissionLoaded:!0,articles:[],isEdit:!1,thread:[],editFormOpen:!1,defaultStep:1,buttonDisabled:!1,editorState:{},expand:!0,SetAsFinalFileModel:!1,accordionKeys:[0],res_status:0,res_modal_status:0,res_modal_message:""},e.closeSetAsFinalFileModelWindow=function(){e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{SetAsFinalFileModel:!1})}))},e.onFileChange=function(t){t.preventDefault(),e.setState({file:t.target.files[0]})},e.handleEditorChange=function(t){e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{editorState:t})}))},e.onDownloadTemplate=function(e,t){e.preventDefault(),(0,Q.Bl)(t).then((function(e){var t=e.headers["content-disposition"].split('"')[1],s=e.data;if(0!==s.size){var a=t.split(".");if("pdf"===(a=a.pop())){var r=window.URL.createObjectURL(new Blob([s],{type:"application/pdf"}));window.open(r,"_blank").document.title=t}else{var n=window.URL.createObjectURL(new Blob([s])),i=document.createElement("a");i.href=n,i.setAttribute("download",t),document.body.appendChild(i),i.click(),i.parentNode.removeChild(i)}}}),(function(e){alert("The file is not available.")}))},e.handleTrashClick=function(t){e.deleteArticle(t)},e.ConfirmError=function(){e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{res_modal_status:0,res_modal_message:""})}))},e.deleteArticle=function(t){e.setState({articles:e.state.articles.filter((function(e){return e._id!==t}))}),(0,Q.oe)(t).then((function(t){var s=t.data.success,a=t.status;s||e.setState({isLoaded:!0,res_modal_status:a})}),(function(t){e.setState({isLoaded:!1,error:t})}))},e.singleExpandtHandler=function(t){var s=(0,a.Z)(e.state.accordionKeys);s[t]=s[t]!==t?t:-1,e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{accordionKeys:s})}))},e.AllCollapsetHandler=function(){e.setState((function(t){return(0,r.Z)((0,r.Z)({},t),{},{expand:!1,accordionKeys:new Array(e.state.thread.messages.length).fill().map((function(e,t){return-1}))})}))},e.AllExpandtHandler=function(){e.setState((function(t){return(0,r.Z)((0,r.Z)({},t),{},{expand:!0,accordionKeys:new Array(e.state.thread.messages.length).fill().map((function(e,t){return t}))})}))},e.getRequirement=function(t){return t.file_type.includes("Essay")?"yes"===t.program_id.essay_required?(0,X.jsx)("p",{children:e.state.thread.program_id.essay_requirements?e.state.thread.program_id.essay_requirements:"No"}):(0,X.jsx)("p",{children:"No"}):t.file_type.includes("ML")?"yes"===t.program_id.ml_required?(0,X.jsx)("p",{children:e.state.thread.program_id.ml_requirements?e.state.thread.program_id.ml_requirements:"No"}):(0,X.jsx)("p",{children:"No"}):t.file_type.includes("RL")?"yes"===t.program_id.rl_required?(0,X.jsx)("p",{children:e.state.thread.program_id.rl_requirements?e.state.thread.program_id.rl_requirements:"No"}):(0,X.jsx)("p",{children:"No"}):void 0},e.handleClickSave=function(t,s){t.preventDefault(),e.setState({buttonDisabled:!0});var n=JSON.stringify(s),i=new FormData;i.append("file",e.state.file),i.append("message",n),(0,Q.me)(e.state.documentsthreadId,e.state.thread.student_id._id,i).then((function(t){var s=t.data,r=s.success,n=s.data,i=t.status;if(r)e.setState({success:r,file:null,editorState:{},thread:n,isLoaded:!0,buttonDisabled:!1,accordionKeys:[].concat((0,a.Z)(e.state.accordionKeys),[n.messages.length-1]),res_modal_status:i});else{var d=t.data.message;e.setState({isLoaded:!0,buttonDisabled:!1,res_modal_message:d,res_modal_status:i})}}),(function(t){e.setState({error:t})})),e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{in_edit_mode:!1})}))},e.handleAsFinalFile=function(t,s,a){e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{doc_thread_id:t,student_id:s,program_id:a,SetAsFinalFileModel:!0})}))},e.ConfirmSetAsFinalFileHandler=function(t){t.preventDefault(),e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{isSubmissionLoaded:!1})}));var s=e.state.program_id?e.state.program_id._id.toString():void 0;(0,Q.lk)(e.state.doc_thread_id,e.state.student_id,s,!0).then((function(t){var s=t.data,a=s.data,n=s.success,i=t.status;if(n)e.setState((function(e){return(0,r.Z)((0,r.Z)({},e),{},{isSubmissionLoaded:!0,thread:(0,r.Z)((0,r.Z)({},e.thread),{},{isFinalVersion:a}),success:n,SetAsFinalFileModel:!1,res_modal_status:i})}));else{var d=t.data.message;e.setState({isLoaded:!0,isSubmissionLoaded:!0,res_modal_message:d,res_modal_status:i})}}),(function(t){e.setState({error:t})}))},e}return(0,i.Z)(s,[{key:"componentDidMount",value:function(){var e=this;(0,Q.vn)(this.props.match.params.documentsthreadId).then((function(t){var s=t.data,a=s.success,r=s.data,n=t.status;a?e.setState({success:a,thread:r,isLoaded:!0,documentsthreadId:e.props.match.params.documentsthreadId,file:null,accordionKeys:new Array(r.messages.length).fill().map((function(e,t){return t===r.messages.length-1?t:-1})),res_status:n}):e.setState({isLoaded:!0,res_status:n})}),(function(t){e.setState({isLoaded:!1,error:t})}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.isLoaded,a=t.isSubmissionLoaded,r=t.res_status,n=t.res_modal_status,i=t.res_modal_message;if(!s&&!this.state.data)return(0,X.jsx)("div",{style:ae.nT,children:(0,X.jsx)(c.Z,{animation:"border",role:"status",children:(0,X.jsx)("span",{className:"visually-hidden"})})});if(r>=400)return(0,X.jsx)(he.Z,{res_status:r});var d,o=window.templatelist.find((function(t){return t.prop.includes(e.state.thread.file_type.split("_")[0])}));return d=this.state.thread.program_id?this.state.thread.student_id.firstname+" "+this.state.thread.student_id.lastname+" - "+this.state.thread.program_id.school+" "+this.state.thread.program_id.program_name+" "+this.state.thread.file_type:this.state.thread.student_id.firstname+" "+this.state.thread.student_id.lastname+" - "+this.state.thread.file_type,(0,X.jsxs)(_.Z,{children:[!s&&(0,X.jsx)("div",{style:ae.nT,children:(0,X.jsx)(c.Z,{animation:"border",role:"status",children:(0,X.jsx)("span",{className:"visually-hidden"})})}),(0,X.jsx)(h.Z,{children:(0,X.jsx)(u.Z,{className:"mb-2 mx-0",children:(0,X.jsx)(u.Z.Header,{children:(0,X.jsxs)(u.Z.Title,{as:"h5",children:[d," Discussion thread","   ",this.state.expand?(0,X.jsx)(p.Z,{className:"btn-sm float-right",onClick:function(){return e.AllCollapsetHandler()},children:"Collaspse"}):(0,X.jsx)(p.Z,{className:"btn-sm float-right",onClick:function(){return e.AllExpandtHandler()},children:"Expand"})]})})})}),this.state.thread.isFinalVersion&&(0,X.jsx)(h.Z,{className:"sticky-top",children:(0,X.jsx)(u.Z,{className:"mb-2 mx-0",bg:"success",text:"white",children:(0,X.jsx)(u.Z.Header,{children:(0,X.jsxs)(u.Z.Title,{as:"h5",className:"text-light",children:["Status: ",(0,X.jsx)("b",{children:"Close"})]})})})}),(0,X.jsx)(h.Z,{children:(0,X.jsx)(u.Z,{className:"mb-2 mx-0",children:(0,X.jsxs)(u.Z.Body,{children:[(0,X.jsxs)(m.Z,{children:[(0,X.jsx)("h5",{children:"Instruction"}),(0,X.jsx)("p",{children:"Please fill our TaiGer template and attach the filled template in this discussion."}),(0,X.jsxs)("p",{children:["Download template:"," ",o?(0,X.jsx)("b",{style:{cursor:"pointer"},onClick:function(t){return e.onDownloadTemplate(t,o.prop)},children:"Link"}):(0,X.jsx)(X.Fragment,{children:"Not available"})]})]}),(0,X.jsxs)(m.Z,{children:[(0,X.jsxs)("h6",{children:[(0,X.jsx)("b",{children:"Requirements:"}),("Agent"===this.props.user.role||"Admin"===this.props.user.role)&&this.state.thread.program_id&&(0,X.jsxs)(x.Z,{to:"/programs/".concat(this.state.thread.program_id._id.toString()),target:"_blank",children:[" ","[Update]"]})]}),this.state.thread.program_id?(0,X.jsx)(X.Fragment,{children:this.getRequirement(this.state.thread)}):(0,X.jsx)(X.Fragment,{children:(0,X.jsx)("p",{children:"No"})}),(0,X.jsxs)("h6",{children:[(0,X.jsx)("b",{children:"Deadline"}),("Agent"===this.props.user.role||"Admin"===this.props.user.role)&&this.state.thread.program_id&&(0,X.jsxs)(x.Z,{to:"/programs/".concat(this.state.thread.program_id._id.toString()),target:"_blank",children:[" ","[Update]"]})]}),this.state.thread.program_id&&(0,X.jsxs)("h6",{children:[this.state.thread.student_id.application_preference&&this.state.thread.student_id.application_preference.expected_application_date?this.state.thread.student_id.application_preference.expected_application_date+"-":"",this.state.thread.program_id.application_deadline]})]})]})})}),(0,X.jsx)(h.Z,{children:(0,X.jsx)(oe,{documentsthreadId:this.state.documentsthreadId,accordionKeys:this.state.accordionKeys,singleExpandtHandler:this.singleExpandtHandler,thread:this.state.thread,onTrashClick:this.handleTrashClick,isLoaded:this.state.isLoaded})}),!0!==this.props.user.archiv?(0,X.jsx)(h.Z,{children:(0,X.jsxs)(u.Z,{className:"my-0 mx-0",children:[(0,X.jsx)(u.Z.Header,{children:(0,X.jsxs)(u.Z.Title,{as:"h5",children:[this.props.user.firstname," ",this.props.user.lastname]})}),(0,X.jsx)(u.Z.Body,{children:this.state.thread.isFinalVersion?(0,X.jsx)(h.Z,{style:{textDecoration:"none"},children:(0,X.jsx)(m.Z,{className:"my-0 mx-0",children:"This discussion thread is close."})}):(0,X.jsx)(h.Z,{style:{textDecoration:"none"},children:(0,X.jsx)(m.Z,{className:"my-0 mx-0",children:(0,X.jsx)(ce,{thread:this.state.thread,buttonDisabled:this.state.buttonDisabled,doc_title:"this.state.doc_title",editorState:this.state.editorState,handleClickSave:this.handleClickSave,file:this.state.file,onFileChange:this.onFileChange})})})})]})}):(0,X.jsx)(h.Z,{children:(0,X.jsx)(u.Z,{className:"my-0 mx-0",children:(0,X.jsx)(u.Z.Body,{children:(0,X.jsx)(h.Z,{style:{textDecoration:"none"},children:(0,X.jsx)(m.Z,{className:"my-0 mx-0",children:"You service is finished. Therefore, you are in read only mode."})})})})}),("Editor"===this.props.user.role||"Agent"===this.props.user.role||"Admin"===this.props.user.role)&&(this.state.thread.isFinalVersion?(0,X.jsx)(h.Z,{className:"mt-2",children:(0,X.jsx)(p.Z,{variant:"danger",onClick:function(t){return e.handleAsFinalFile(e.state.thread._id,e.state.thread.student_id._id,e.state.thread.program_id,e.state.thread.isFinalVersion)},children:a?"Mark as open":(0,X.jsx)(c.Z,{animation:"border",role:"status",size:"sm",children:(0,X.jsx)("span",{className:"visually-hidden"})})})}):(0,X.jsx)(h.Z,{className:"mt-2",children:(0,X.jsx)(p.Z,{variant:"success",onClick:function(t){return e.handleAsFinalFile(e.state.thread._id,e.state.thread.student_id._id,e.state.thread.program_id,e.state.thread.isFinalVersion)},children:a?"Mark as finished":(0,X.jsx)(c.Z,{animation:"border",role:"status",size:"sm",children:(0,X.jsx)("span",{className:"visually-hidden"})})})})),(0,X.jsxs)(f.Z,{show:this.state.SetAsFinalFileModel,onHide:this.closeSetAsFinalFileModelWindow,"aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[(0,X.jsx)(f.Z.Header,{children:(0,X.jsx)(f.Z.Title,{id:"contained-modal-title-vcenter",children:"Warning"})}),(0,X.jsxs)(f.Z.Body,{children:["Do you want to set ",d," as"," ",this.state.thread.isFinalVersion?"open":"final","?"]}),(0,X.jsxs)(f.Z.Footer,{children:[(0,X.jsx)(p.Z,{disabled:!s||!a,onClick:function(t){return e.ConfirmSetAsFinalFileHandler(t)},children:a?"Yes":(0,X.jsx)(c.Z,{animation:"border",role:"status",size:"sm",children:(0,X.jsx)("span",{className:"visually-hidden"})})}),(0,X.jsx)(p.Z,{onClick:this.closeSetAsFinalFileModelWindow,children:"No"})]})]}),n>=400&&(0,X.jsx)(ue.Z,{ConfirmError:this.ConfirmError,res_modal_status:n,res_modal_message:i})]})}}]),s}(l.Component),me=pe}}]);